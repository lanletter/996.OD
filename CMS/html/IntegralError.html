<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>积分异常查询</title>
    <link rel="stylesheet" href="../layui/css/layui.css">
    <link rel="stylesheet" href="../css/Product.css">
    <link rel="stylesheet" href="../css/common.css">
</head>
<body style="background-color: #fff;">
<header class="layui-clear">
    <div id="reorder" class="f-l">
        <div>
            <i class="f-l" style="line-height: 32px;">每日获取上限：</i>
            <div id="search" class="f-l">
                <input type="text" value="200" onkeydown="EnterPress()">
                <i id="searchMenu">🔍</i>
            </div>
        </div>
    </div>
</header>

<table class="layui-hide" id="demo"></table>

<script src="../layui/layui.js"></script>
<script src="../js/jquery.js"></script>
<script src="../js/urlport.js"></script>
<script>


    var getSum=$("#search input").val();
    ajaxfunction(getSum);//调用ajax

    /**点击搜索事件**/
    $("#searchMenu").on().click(function () {
        getSum=$("#search input").val();
        $("tbody").remove();
        ajaxfunction(getSum);//调用ajax
    });

    /**回车键触发点击搜索**/
    function EnterPress(){
        if(event.keyCode == 13){
            $("#searchMenu").trigger("click");
        }
    }

    function ajaxfunction(getSum) {
        console.log(getSum);
        $.ajax({
            url: urlport + 'integral/getAbnormalList',
            dataType: "json",
            type: "post",
            data: JSON.stringify({
                "getSum": getSum,
                "days": 30,
                "pageNum":"",
                "pageSize":""
            }),
            contentType: 'application/json;charset=UTF-8',
            success: function (data) {
                console.log(data);
                var userList = data.data;
                console.log(userList);
                layui.use('table', function(){
                    var table = layui.table;

                    //展示已知数据
                    table.render({
                        elem: '#demo'
                        ,cols: [[ //标题栏
                            {field: 'LAY_TABLE_INDEX', title: '序号', width:80, sort: true}
                            ,{field: 'userId', title: '用户ID', width:180, sort: true}
                            ,{field: 'nickName', title: '昵称', width:180}
                            ,{field: 'getSum', title: '当日获取积分', width:180, sort: true}
                            ,{field: 'date', title: '日期', width: 180, sort: true}
                            ,{field: 'accountName', title: '手机号', width: 180, sort: true}
                        ]]
                        ,data: userList
                        ,even: true
                        ,page: true //是否显示分页
                        ,limit: 10 //每页默认显示的数量
                    });
                });
            },
            error: function () {
                $("table").append("数据请求失败");
            }
        })

    }

</script>
</body>
</html>