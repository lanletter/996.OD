<!doctype html>
<html class="no-js">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
    <meta name="format-detection" content="telephone=no">
    <title>我的体质</title>
    <link rel="stylesheet" href="../css/global.css">
    <link rel="stylesheet" href="../css/healthdetail.css">
    <link rel="stylesheet" href="../css/app.css"  id="appcss" disabled>
    <style></style>
</head>
<body>
<header>
    <div class="topbar bBor"> <b class="back"></b>
        <h1>我的体质</h1>
        <span class="other" tapmode onclick="$.JR.openWin('./test.html', 'test',{'title':'测试',frameUrl:'health/test.html',frameName:'health_test'})">重测</span> </div>
</header>
<div id="main">
</div>
<script id="main-template" type="text/x-dot-template">
    <div class="progress_wrap tBor bBor">
        <div class="pad">
            <h4 id="healthname"></h4>
            <span>您的倾向体质</span>
            <div class="jindu">
                <div class="jin_top">
                    <ul>
                        <li>
                            <div id="prog1" value="0" max="100" class="healthScoreA progress"></div>
                        </li>
                        <li>
                            <div id="prog2" value="0" max="100" class="healthScoreB progress"></div>
                        </li>
                        <li>
                            <div id="prog3" value="0" max="100" class="healthScoreC progress"></div>
                        </li>
                        <li>
                            <div id="prog4" value="0" max="100" class="healthScoreD progress"></div>
                        </li>
                        <li>
                            <div id="prog5" value="0" max="100" class="healthScoreE progress"></div>
                        </li>
                        <li>
                            <div id="prog6" value="0" max="100" class="healthScoreF progress"></div>
                        </li>
                        <li>
                            <div id="prog7" value="0" max="100" class="healthScoreG progress"></div>
                        </li>
                        <li>
                            <div id="prog8" value="0" max="100" class="healthScoreH progress"></div>
                        </li>
                        <li>
                            <div id="prog9" value="0" max="100" class="healthScoreI progress"></div>
                        </li>
                    </ul>
                </div>
                <div class="jin_bottom">
                    <ul>
                        <li class="healthA">
                            <div class="name">平和质</div>
                        </li>
                        <li  class="healthB">
                            <div class="name">气虚质</div>
                        </li>
                        <li class="healthC">
                            <div class="name">阳虚质</div>
                        </li>
                        <li class="healthD">
                            <div class="name">阴虚质</div>
                        </li>
                        <li class="healthE">
                            <div class="name">痰湿型</div>
                        </li>
                        <li class="healthF">
                            <div class="name">湿热型</div>
                        </li>
                        <li class="healthG">
                            <div class="name">血瘀质</div>
                        </li>
                        <li class="healthH">
                            <div class="name">气郁质</div>
                        </li>
                        <li class="healthI">
                            <div class="name">特禀质</div>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
    <div class="allSpecial bBor">
        <div class="pad">
            <h4>总体特征</h4>
            <p>{{=it.healthType.desc}}</p>
            <div class="info">
                {{ var tags = it.healthType.desc_tags.split('|');}}
                {{ for(var i in tags) { }}
                <div class="cial">{{=tags[i]}}</div>
                {{ } }}
            </div>
        </div>
    </div>
    <div class="recommend bBor" style="padding-bottom: 20px;">
        <div class="pad">
            <h2><i></i>推荐健康餐</h2>
            <h4>{{=it.healthType.rec_food_title}}</h4>
            <p>{{=it.healthType.rec_food_desc}}</p>
            {{ for(var i in it.healthType.menus) { }}
            {{ var menu = it.healthType.menus[i];}}
            {{?menu&&menu.menu}}
            <div class="pic" tapmode onclick="$.JR.openWin('../con_title.html', 'food',{'title':'菜谱',frameUrl:'class/food.html',frameName:'class_food',id:'{{=menu.menu_id}}'})">
                <img src="{{=$.JR.S(menu.menu.picture&&menu.menu.picture.path)}}" onload="picloaded(this)" onerror="this.src='../img/global/pre_01.jpg';" height="{{=picHeight}}">
                <div class="pH"></div>
                <div class="tit">
                    <p>{{=menu.menu.menuTypeName}}</p>
                    <span>{{=menu.menu.name}}</span> </div>
            </div>
            <div class="introduce">
                <p>{{=menu.desc}}</p>
            </div>
            {{?}}
            {{ } }}
            {{?(it.healthType.menus&&it.healthType.menus.length==3)}}
            <div class="more"><a tapmode onclick="$.JR.openWin('../con_title.html', 'healthfood',{'title':'健康餐',frameUrl:'health/food.html',frameName:'health_food',type:'{{=it.healthType.id}}'})">更多健康餐</a></div>
            {{?}}
        </div>
    </div>
    <div class="recommend commed_03 bBor" style="padding-top: 0">
        <div class="pad">
            <h2><i></i>推荐食材</h2>
            <h4>{{=it.healthType.rec_material_title}}</h4>
            <p>{{=it.healthType.rec_material_desc}}</p>
            {{ for(var i in it.healthType.materials) { }}
            {{ var material = it.healthType.materials[i];}}
            <div class="pic"> <img src="{{=$.JR.S(material.material.picture&&material.material.picture.path)}}" onload="picloaded(this)" onerror="this.src='../../img/health/lanmei.jpg';" height="{{=picHeight}}">
                <div class="pH"></div>
                <div class="tit"> <span>{{=material.material.name}}</span> </div>
            </div>
            <div class="introduce">
                <p>{{=material.desc}}</p>
            </div>
            {{ } }}
            {{?(it.healthType.materials&&it.healthType.materials.length==3)}}
            <div class="more"><a tapmode onclick="$.JR.openWin('../con_title.html', 'healthmaterial',{'title':'健康食材',frameUrl:'health/material.html',frameName:'health_material',type:'{{=it.healthType.id}}'})">更多食材</a></div> </div>
        {{?}}
    </div>
</script>
<script src="../js/jquery-2.1.1.min.js"></script>
<script src="../js/doT.min.js"></script>
<script src="../js/s.js"></script>
<script>
    var mainTempFn = doT.template($('#main-template').text());
    var health, picWidth,picHeight;
    $(function(){
        if ($.JR.needLogin()) return;
        picWidth = ($(window).width()-30);
        picHeight = (picWidth)*0.89;
        initHealth();
        $.JR.addEventHandle("sendHealthRetestEvent", function(){
            $.JR.closeWin(500);
            $.JR.openWin('../con_title.html', 'test',{'title':'测试',frameUrl:'health/test.html',frameName:'health_test'})
        });
        $.JR.addEventHandle("userInfoUpdate", function(){
            initHealth();
        });
    });
    function initHealth() {
        $.JR.jajax('/health/user.json', {
            userId: $.JR.userid()
        }, function (data) {
            if (data.status == 200) {
                health = data.data;
                $('#main').html(mainTempFn(health));
                $('.healthScore'+health.healthtypeId).addClass('on');
                $('.health'+health.healthtypeId).addClass('on');
                $('#healthname').text($('.health'+health.healthtypeId).text());
                $('.healthScoreA').css('height',health.ascore+'%');
                $('.healthScoreB').css('height',health.bscore+'%');
                $('.healthScoreC').css('height',health.cscore+'%');
                $('.healthScoreD').css('height',health.dscore+'%');
                $('.healthScoreE').css('height',health.escore+'%');
                $('.healthScoreF').css('height',health.fscore+'%');
                $('.healthScoreG').css('height',health.gscore+'%');
                $('.healthScoreH').css('height',health.hscore+'%');
                $('.healthScoreI').css('height',health.iscore+'%');
                $.JR.tapmode();
            } else {
                $.JR.tip('网络请求出错!');
            }
        }, function (error) {
            $.JR.tip('网络请求出错，请稍后再试!');
        });
    }
    function picloaded(ele) {
        var image = $(ele);
        var ww = image.width();
        image.css({marginLeft:(picWidth-ww)/2});
    }
</script>
</body>
</html>
