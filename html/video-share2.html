<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <!-- 这是个iphone设备中的safari私有meta标签，它表示：允许全屏模式浏览；-->
    <meta content="yes" name="apple-mobile-web-app-capable">
    <!-- 全屏显示-->
    <meta name="apple-touch-fullscreen" content="yes">
    <!-- 不要让设备识别电话号码和邮箱地址-->
    <meta content="telephone=no,email=no" name="format-detection">
    <meta name="viewport" content="width=device-width,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no"/>
    <meta content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no" id="viewport"
          name="viewport">
    <!-- DNS预解析-->
    <meta http-equiv="x-dns-prefetch-control" content="on">
    <link href="../css/common.css?ver=403" rel="stylesheet">
    <link href="../css/video-share2.css?ver=403" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="../css/video-js.min.css?ver=403">
    <title>直播分享</title>
    <script type='text/javascript'>
        var _vds = _vds || [];
        window._vds = _vds;
        (function () {
            _vds.push(['setAccountId', '80624a28abff7348']);
            (function () {
                var vds = document.createElement('script');
                vds.type = 'text/javascript';
                vds.async = true;
                vds.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + 'dn-growing.qbox.me/vds.js';
                var s = document.getElementsByTagName('script')[0];
                s.parentNode.insertBefore(vds, s);
            })();
        })();
    </script>
</head>
<body>
<!--<div id="videobox" class="video">-->
    <!--<video id="vd" class="video-js vjs-default-skin" controls="controls" webkit-playsinline="" playsinline="" glue-id="video"-->
           <!--glue-component="common.component.universalPlayer.video" glue-behavior="common.behavior.player.dispatcher"-->
           <!--src="">-->
        <!--<source type="application/x-mpegURL">-->
    <!--</video>-->
    <!--<button class="play"></button>-->
<!--</div>-->
<div id="videobox" class="video">
    <video id="vd" class="video-js vjs-default-skin" controls="controls" preload="auto" data-setup='{}'>
        <source type="application/x-mpegURL">
    </video>
</div>
<div class="vide-share">
    <div class="tit">
        <img :src="kk.cookPicture" alt="">
        <p class="name">{{kk.name}}</p>
        <p class="cookdesc">{{kk.topic}}</p>
        <p class="header__opt">
            <span class="view-count">{{kk.count}}</span>
        </p>
        <h3>简介</h3>
        <p class="introduct">{{kk.desc}}</p>
    </div>
</div>
<div class="footer">
    <img src="../img/logoblack.png">
    <p>
        <span>方太生活家</span>
        <span>分享生活味道</span>
    </p>
    <a onclick="javascript:window.location.href='http://download.fotilestyle.com/?utm-source=share'">下载App</a>
</div>
<script src="../js/lib.js"></script>
<script src="../js/vue.min.js"></script>
<script src="../js/vue-resource1.3.4.js"></script>
<script src="../js/url.js"></script>
<script src="https://res.wx.qq.com/open/js/jweixin-1.2.0.js"></script>

<script>
    function GetQueryString(name) {
        var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
        var r = window.location.search.substr(1).match(reg);
        if (r != null) return unescape(r[2]);
        return null;
    }

    var id = GetQueryString("id");

    /*选项卡*/
    function changeTab(tabCon_num) {
        for (i = 0; i <= 1; i++) {
            document.getElementById("tabCon_" + i).style.display = "none"; //将所有的层都隐藏
            document.getElementById("tab_" + i).classList.remove("selected");
        }
        document.getElementById("tabCon_" + tabCon_num).style.display = "block";//显示当前层
        document.getElementById("tab_" + tabCon_num).classList.add("selected");
    }


    (function () {
        var video = $('#videobox video')[0],
            playBtn = $('#videobox .play');
        playBtn.on('click', function () {
            $(this).hide();
            var vheight = $("#videobox video").height();
            $('#vd').css({"position": "absolute", "left": "0"});
            $("#videobox").css({height: vheight - 1 + "px"});
            video.play();
            video.controls = true;
        });

        video.addEventListener('ended', function () {
            playBtn.show();
            video.controls = false;
            $('#vd').css({"position": "absolute", "left": "-10rem"});
            $("#videobox").css({"height": "4.2rem"});
        }, false);
        video.addEventListener('pause', function () {
            playBtn.hide();
            video.controls = true;
        }, false);
    })();

    var vm = new Vue({
        el: '.vide-share',
        data: {
            kk: {}
        },
        created: function () {
            var $this = this;
            this.$http.post(urlport + 'video/detail', {"id": "1111"}).then(function (data) {
                var data = data.data;
                if (data.status == 200) {
                    $this.kk = data.data;
                    console.info($this.kk);

                    /*视频链接*/
                    $('#vd').find('source').attr('src', $this.kk.url);

                    /*微信分享链接专用*/
                    var sharetitle = data.data.topic;
                    var sharedesc = data.data.desc;
                    var shareimg = data.data.picture;
                    var sharestr = window.location.href;
                    var sharelink = sharestr.replace(/api/, "h5");
                    console.log(sharetitle + "|" + shareimg + "|" + sharelink + "|" + sharedesc);
                    $.ajax({
                        type: 'GET',
                        url: urlport + 'wx/wxConfig.json?url=' + encodeURIComponent(window.location.href.split('#')[0]),
                        success: function (data) {
                            console.info(data.appId);
                            wx.config({
                                debug: false, // 开启调试模式,调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印。
                                appId: data.appId, // 必填，公众号的唯一标识
                                timestamp: data.timestamp, // 必填，生成签名的时间戳
                                nonceStr: data.nonceStr, // 必填，生成签名的随机串
                                signature: data.signature,
                                jsApiList: [
                                    "onMenuShareTimeline",
                                    "onMenuShareAppMessage",
                                    "onMenuShareQQ",
                                    "onMenuShareWeibo",
                                    "onMenuShareQZone"
                                ]
                            });
                            wx.ready(function () {
                                //分享给朋友圈
                                wx.onMenuShareTimeline({
                                    title: sharetitle, // 分享标题
                                    link: sharelink, // 分享链接，该链接域名或路径必须与当前页面对应的公众号JS安全域名一致
                                    imgUrl: shareimg, // 分享图标
                                    success: function () {
                                        // 用户确认分享后执行的回调函数
                                    },
                                    cancel: function () {
                                        // 用户取消分享后执行的回调函数
                                    }
                                });
                                //分享给朋友
                                wx.onMenuShareAppMessage({
                                    title: sharetitle, // 分享标题
                                    desc: sharedesc, // 分享描述
                                    link: sharelink, // 分享链接，该链接域名或路径必须与当前页面对应的公众号JS安全域名一致
                                    imgUrl: shareimg, // 分享图标
                                    type: '', // 分享类型,music、video或link，不填默认为link
                                    dataUrl: '', // 如果type是music或video，则要提供数据链接，默认为空
                                    success: function () {
                                        // 用户确认分享后执行的回调函数
                                    },
                                    cancel: function () {
                                        // 用户取消分享后执行的回调函数
                                    }
                                });
                            });
                        },
                        error: function (xhr, type) {
                            //alert(111);
                        }
                    })
                }

            }, function () {
                console.info('error');
            });

        },
        updated: function () {
            console.info(11);
        },
        mounted: function () {
            //var myPlayer = neplayer("my-video");
            // var $this = this;
            // console.info();
            // function InitPlayer(){
            //     console.info($this.kk.url);
            //     var player = new prismplayer({
            //         id: "J_prismPlayer",    // 容器id
            //         source: 'http://lifevideo.fotile.com/fotilestyle/shanghai.m3u8',  // 视频url 支持互联网可直接访问的视频地址
            //         autoplay: true,       // 自动播放
            //         width: "100%",        // 播放器宽度
            //         height: "400px"      // 播放器高度
            //     });
            // }
            // InitPlayer();
        }, methods: function () {

        }
    });

</script>
<script type="text/javascript" src='../js/video.min.js'></script>
<script src="../js/videojs-live.js"></script>
</body>
</html>