<!DOCTYPE html>
<html>

<head>
  <title>生活志文章文章内页</title>
  <meta charset="utf-8">
  <meta name='viewport' content='width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no,minimum-scale=1.0'>
  <link rel="stylesheet" type="text/css" href="../css/common.css">
  <link rel="stylesheet" type="text/css" href="../css/ftcomment.css">
  <link rel="stylesheet" type="text/css" href="../css/lifearticle.css">
</head>

<body>
  <header class="header">
    <div class="header__main">
        <!-- 视频无背景 -->
        <!--<div class='video'>-->
            <!--<video poster="http://pic.qiantucdn.com/58pic/17/09/84/45U58PICTGg_1024.jpg!/watermark/url/L3dhdGVybWFyay12MS4zLnBuZw==/align/center">-->
                <!--<source src="http://pic.qiantucdn.com/58pic/shipin/17/09/84/17098445.mp4" type="video/mp4">-->
            <!--</video>-->
            <!--<button class="play"></button>-->
        <!--</div>-->
        <!-- 视频有背景 -->
        <div class='video'>
            <video poster="none">
                <source src="http://pic.qiantucdn.com/58pic/shipin/17/09/84/17098445.mp4" type="video/mp4">
            </video>
            <button class="play"></button>
        </div>
        <hgroup>
      	    <h3>一道冬天就想到的菜肴</h3>
        </hgroup>
    </div>
    <div class="header__opt">
      <span class="view-count"><strong>234</strong></span>
      <span class="comment-count"><strong>4324</strong></span>
      <span class="favorite-count"><strong>432</strong></span>
    </div>
  </header>
  <section class="author">
  	<div class="author__title"><span>作者</span></div>
  	<div class="clearfix">
  		<p class="author__info"><img src="../img/testheader.jpg">	<span>大萝卜头</span></p>
  		<button class="add-care">加关注</button>
  	</div>
  </section>

  <article class="content">
  	
  </article>

  <div class="bottomdiv"></div>

  <section class="recommend">
  	<h3 class="section-title">推荐阅读</h3>
  	<ul>
  		
  	</ul>
  </section>

  <div class="bottomdiv"></div>

  <div class="ft-comment"></div>

  <script type="text/javascript" src='../js/lib.js'></script>
  <script type="text/javascript" src='../js/api.js'></script>
  <script type="text/javascript" src='../js/loadcomment.js'></script>
  <script type="text/javascript">
    $(function () {
      (function () {
        var video = $('.video video')[0],
          playBtn = $('.video .play');
        playBtn.on('click', function() {
          $(this).hide();
          video.play();
        })
        
        video.addEventListener('ended',function(){
           playBtn.show();
        },false);
        video.addEventListener('pause',function(){
           playBtn.show();
        },false);
      })();
    
      $api.post('http://121.40.135.115:8080/fotile-api-0.0.2/test/wantFeel/detail', { 
        "userName": "test", 
        "address": "gz", 
        id: 123 
      }, function (data) {
        callback(data);
      })

      function callback(res) {
        if (res.status !== 200) {
          alert(res.errorMessage)
          return;
        }
        var data = res.data;
        var $header = $('.header'),
        $content = $('.content');
        $header.find('.header__main h3').text(data.longTitle || data.shortTitle || ' ');
        $api.imgAdapt($header.find('.header__main .img'), data.coverPicture.path)
        $header.find('.view-count strong').text(data.viewCount);
        $header.find('.comment-count strong').text(data.commentCount);
        $header.find('.favorite-count strong').text(data.favoriteCount);

        $('.add-care').data('id', data.id).data('follow', false);

        $('.author__info img').attr('src', data.author.picture.path);
        $('.author__info span').text(data.author.name);

        $content.append(data.content);

        data.recommendWantFeelList.forEach(function(item, index) {
          var el = $('<li class="recommend__info">\
            <a href="#"><img src="' + item.picture.path + '"></a>\
            <div>\
              <h5>' + item.longTitle + '</h5>\
              <span> <i>' + item.tags + '</i>#/<time>' +  (new Date(item.createat)).pattern("yyyy.MM.dd")+ '</time></span>\
            </div>\
          </li>');
          $('.recommend ul').append(el);
        });
      };

      $.loadComment({"pageNum":1,"pageSize":5,"refId":434,"type":5,"userId":81177}, 1);

      $('.add-care').on('click', function(e) {
        var id = $(e.target).data('id'),
          follow = $(e.target).data('follow');
        if (follow) {
          $api.post('http://121.40.135.115:8080/fotile-api-0.0.2/follow/cookCancel', { 
            "refId": id, 
            "type": 2, 
            "userId": 85507
          }, function (data) {
            $(e.target).data('follow', false).text('加关注');
          });
        } else {
          $api.post('http://121.40.135.115:8080/fotile-api-0.0.2/follow/cook', { 
            "refId": id, 
            "type": 2, 
            "userId": 85507
          }, function (data) {
            $(e.target).data('follow', true).text('已关注');
          });
        }
      })
    });
  </script>
</body>

</html>
