<!DOCTYPE html>
<html>

<head>
    <title>活动详情</title>
    <meta charset="utf-8">
    <meta name='viewport'
          content='width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no,minimum-scale=1.0'>
    <script src="../js/tingyun-rum.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/common.css?ver=403">
    <link rel="stylesheet" type="text/css" href="../css/ftcomment.css?ver=403">
    <link rel="stylesheet" type="text/css" href="../css/activedetail.css?ver=403">
    <link rel="stylesheet" type="text/css" href="../css/active-pro.css?ver=403">
    <script>
        !function (e, t, n, g, i) {
            e[i] = e[i] || function () {
                (e[i].q = e[i].q || []).push(arguments)
            }, n = t.createElement("script"), tag = t.getElementsByTagName("script")[0], n.async = 1, n.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + g, tag.parentNode.insertBefore(n, tag)
        }(window, document, "script", "assets.growingio.com/2.1/gio.js", "gio");
        gio('init', '80624a28abff7348', {});
    </script>
</head>

<body style="overflow-x: hidden;">
<div class="avtive">
    <div class=" pbfoot">
        <header class="header">
            <div class="header_img" :style="{backgroundImage: 'url(' + data.picture.path + ')'}"></div>
            <div class="header__main">
                <div class="title">
                    <h3 class="txt" v-html="data.title"></h3>
                    <time v-if="data.isshow == 1 || data.isshow == null " v-html="data.time2"></time>
                </div>
            </div>
            <div class="header__opt">
                <span class="view-count"><strong v-html="data.viewCount"></strong></span>
                <span class="comment-count" id="star"><strong v-html="data.commentCount"></strong></span>
            </div>
        </header>
        <article id="instructions" v-html="data.content">
        </article>
    </div>

    <div class="worklist">
        <h2>优秀作品</h2>
        <div class="listarea" v-if="datalist.count !== 0">
            <ul class="list">
                <li v-for="(item,index) in datalist.workList">
                    <div class="workdetail">
                        <div v-if="parseInt(item.picturePathImageHeight) > parseInt(item.picturePathImageWidth)"
                             class="pageimg1" :style="{backgroundImage: 'url(' + item.picturePath + ')'}"
                             @click="imgclick">
                            <img class="pageimg2" :src="item.picturePath" style="display: none;">
                        </div>
                        <div v-else class="pageimg" :style="{backgroundImage: 'url(' + item.picturePath + ')'}"
                             @click="imgclick">
                            <img class="pageimg2" :src="item.picturePath" style="display: none;">
                        </div>
                        <!--<img class="pageimg"  :src="item.picturePath">-->
                        <div class="userinfo">
                            <div @click="homeuser(item.userId)" class="imgparent">
                                <img class="userimg" :src="item.titlePicture">
                            </div>
                            <span v-html="item.nickName"></span>
                        </div>
                        <p class="usertxt">我做的特别好，你们快 来也可以试试来也可以试试</p>
                        <span class="likenum" v-html="item.likeCount" @click="deeplikopen"></span>
                    </div>
                </li>
                <div style="float: left;width: 1px;overflow: hidden;color: #fff;">1</div>
            </ul>
        </div>
    </div>
    <div class="worklist" id="menushow">
        <h2>晒作品</h2>
        <a class="moremenu arrow" @click="deeplikopen">全部<span v-html="datalist.count"></span>个作品</a>
        <div class="listarea" v-if="datalist.count !== 0">
            <ul class="list">
                <li v-for="(item,index) in datalist.workList">
                    <div class="workdetail">
                        <div v-if="parseInt(item.picturePathImageHeight) > parseInt(item.picturePathImageWidth)"
                             class="pageimg1" :style="{backgroundImage: 'url(' + item.picturePath + ')'}"
                             @click="imgclick">
                            <img class="pageimg2" :src="item.picturePath" style="display: none;">
                        </div>
                        <div v-else class="pageimg" :style="{backgroundImage: 'url(' + item.picturePath + ')'}"
                             @click="imgclick">
                            <img class="pageimg2" :src="item.picturePath" style="display: none;">
                        </div>
                        <div class="userinfo">
                            <div @click="homeuser(item.userId)" class="imgparent">
                                <img class="userimg" :src="item.titlePicture">
                            </div>
                            <span v-html="item.nickName"></span>
                        </div>
                        <p class="usertxt">我做的特别好，你们快 来也可以试试来也可以试试</p>
                        <span class="likenum" v-html="item.likeCount" @click="deeplikopen"></span>
                    </div>
                </li>
                <div style="float: left;width: 1px;overflow: hidden;color: #fff;">1</div>
            </ul>
        </div>
        <button class="menushowbtn" @click="deeplikopen">我要晒作品</button>
    </div>

    <div id="ask">
        <h2>问大家</h2>
        <a class="moreask arrow" @click="deeplikopen">全部<span v-html="dataask.count"></span>个问题</a>
        <div class="listarea" v-if="dataask.count !== 0">
            <ul class="asklist">
                <li v-for="(item,index) in dataask.answerList" @click="deeplikopen">
                    <div class="ask">
                        <p class="title">
                            <img class="askimg" :src="item.titlePicture">
                            <span v-html="item.nickName"></span><br>
                        </p>
                        <p class="txt" v-html="item.content"></p>
                        <p class="noanswer" v-if="item.nickNameAnswer == '' ">
                            <span>0 回答</span>
                            <span>我要回答</span>
                        </p>
                    </div>
                    <div class="answer" v-if="item.nickNameAnswer !== '' ">
                        <div class="best" v-if="item.bestAnswer == 1"></div>
                        <div class="answerinfo">
                            <img class="answerimg" :src="item.titlePictureAnswer">
                            <span class="answername" v-html="item.nickNameAnswer"></span>
                        </div>
                        <p class="content" v-html="item.contentAnswer"></p>
                        <p class="num">
                            <span class="likeCount" v-html="item.likeCountAnswer"></span>
                            <span class="answerCount">全部{{item.answerCount}}个回答</span>
                        </p>
                    </div>
                </li>
            </ul>
        </div>
        <div class="askstyle" v-if="dataask.count == 0">
            <img src="../img/noask.png">
            <p>还没有人发表问题哦</p>
        </div>
        <button class="askbtn" @click="deeplikopen">我要提问</button>
    </div>

    <div class="menulist" style="display: none;">
        <ul class="menuul">
            <li v-for="(item,index) in datamenu.list">
                <a class="menuleft" :href="item.url" :style="{backgroundImage: 'url(' + item.picture + ')'}"></a>
                <div class="menuright">
                    <p class="name" v-html="item.name"></p>
                    <p class="num">
                        <span class="viewnum" v-html="item.pageviews"></span>
                        <span class="collectnum" v-html="item.collect_count"></span>
                    </p>
                </div>
            </li>
        </ul>
        <div class="floatbtn">
            <a @click="closelist">返回活动详情</a>
        </div>
    </div>

    <div class="floatbtn" id="menuup">
        <a @click="openlist">我要参与</a>
        <!--<a class="over">活动已结束</a>-->
        <span class="device" style="display: none"></span>
    </div>
</div>

<script src="https://res.wx.qq.com/open/js/jweixin-1.2.0.js"></script>
<script type="text/javascript" src='../js/lib.js'></script>
<script type="text/javascript" src='../js/api.js'></script>
<script type="text/javascript" src='../js/jquery.cookie.js'></script>
<script type="text/javascript" src="../js/ajaxsetup.js"></script>
<script src="../js/BigPictureOpen.js"></script>
<script src="../js/vue.min.js"></script>
<script src="../js/vue-resource1.3.4.js"></script>
<script type="text/javascript" src='../js/deeplink.js'></script>
<script type="text/javascript" src='../js/loadcomment.js'></script>
<script type="text/javascript" src='../js/ft.js'></script>
<script type="text/javascript" src='../js/judge.js'></script>
<script type="text/javascript" src="../js/url.js"></script>
<script type="text/javascript" src="../js/UMAnalytics.js"></script>

<script type="text/javascript">
    function GetQueryString(name) {
        var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
        var r = window.location.search.substr(1).match(reg);
        if (r != null) return unescape(r[2]);
        return null;
    }

    var id = GetQueryString("id");

    var device = GetQueryString("device");

    if (device == "ios" || device == "android") {
        var userid;
        var token;
        //app交互—获取userid
        window.onload = function () {
            ft.isLogin2(function (result) {
                var errorcode = result.errorCode.toString();
                //alert(errorcode);
                console.log(errorcode);
                if (errorcode == "1") {
                    userid = result.data.userId.toString();
                    $.cookie('userid', userid);
                    if (userid !== "1" && userid !== 1) {
                        token = result.data.token.toString();
                        $.cookie('token', token);
                    }

                    choose();

                } else if (errorCode == "0") {
                } else if (errorCode == "-1") {
                } else if (errorCode == "-2") {
                }
            });
        };
    } else {
        var userid = 1;
        var token;
        choose();
    }

    function choose() {
        var vm = new Vue({
            el: '.avtive',
            data: {
                data: {},
                dataask: {},
                datalist: {},
                datamenu: {}
            },
            created: function () {
                var $this = this;

                $.ajax({
                    url: urlport + 'activity/detail',
                    type: 'POST',
                    data: JSON.stringify({"id": id}),
                    timeout: 5000, //超时时间
                    contentType: "application/json;charset=utf-8",
                    dataType: 'json', //返回的数据格式
                    success: function (data) {
                        // console.log(data);
                        callback(data);
                    },
                    error: function (errorMsg) {
                        console.log('错误');
                        console.log(errorMsg);
                    }
                });

                function callback(data) {
                    var data = data;
                    // console.log(data);
                    $this.data = data.data;
                    console.log($this.data);

                    var $header = $('.header');
                    $(".ft-titles .comment_count").text(data.commentCount);

                    /*title取值*/
                    var txt = data.title;
                    if (txt == undefined) {
                        $('head title').text("活动详情");
                    } else {
                        $('head title').text(data.title);
                    }

                    /*友盟埋点-页面访问*/
                    var isuserid;//登录判断
                    if (userid !== 1 && userid !== "1") {
                        isuserid = "是";
                    } else {
                        isuserid = "否";
                    }
                    console.log(isuserid);
                    UMAnalyticsAgent.trackWithProperty("h5页面访问", {
                        "页面类型": "活动详情页",
                        "页面名称": data.title,
                        "是否登录": isuserid
                    });

                    $("#menuup .device").unbind().on("click", function () {
                        ft.callMenuUp(function (result) {
                            //native触发
                        });
                    });


                    if (device == "ios" || device == "android") {
                        /*上传菜谱模块*/
                        if (data.buttonStatus == 1 || data.buttonStatus == "1") {
                            $("#menuup").show();
                        }
                        $("#menuup a").unbind().on("click", function () {
                            $.ajax({
                                url: urlport + 'activity/clickCount',
                                type: 'POST',
                                data: JSON.stringify({"id": id}),
                                timeout: 5000, //超时时间
                                contentType: "application/json;charset=utf-8",
                                dataType: 'json', //返回的数据格式
                                success: function (data) {
                                    console.log(data);
                                },
                                error: function (errorMsg) {
                                    console.log('错误');
                                    console.log(errorMsg);
                                }
                            });
                            $(".device").trigger('click');
                        });
                    }

                    /* 时间戳格式转换 */
                    var starttime = data.startDate;
                    var endtime = data.endDate;

                    function add0(m) {
                        return m < 10 ? '0' + m : m
                    }

                    function format(starttime) {
                        var time = new Date(starttime);
                        var year = time.getFullYear();
                        var month = time.getMonth() + 1;
                        var date = time.getDate();
                        var hour = time.getHours();
                        var minute = time.getMinutes();
                        return year + '年' + add0(month) + '月' + add0(date) + '号' + add0(hour) + ':' + add0(minute);
                    }

                    function format(endtime) {
                        var time = new Date(endtime);
                        var year = time.getFullYear();
                        var month = time.getMonth() + 1;
                        var date = time.getDate();
                        var hour = time.getHours();
                        var minute = time.getMinutes();
                        return year + '年' + add0(month) + '月' + add0(date) + '号' + add0(hour) + ':' + add0(minute);
                    }

                    if (data.isshow == 1 || data.isshow == null) {
                        // $header.find('time').text(format(starttime) + '-' + format(endtime));//显示时间戳
                        $header.find('time').text(data.time2);//显示字符串
                    } else {
                        $header.find('time').text();
                    }

                    /*文章内链接加device，必须放在content内容append后面！*/
                    var qs = 'device=' + device + '&jump=jump';
                    $("#instructions").find('a').each(function () {
                        var href = $(this).attr('href');
                        console.log(href);
                        if (href) {
                            href += (href.match(/\?/) ? '&' : '?') + qs;
                            $(this).attr('href', href);
                            console.log(href);
                        }
                    });


                    id=200;
                    userid=1;
                    /*晒作品*/
                    $(document).ready(function () {
                        $.ajax({
                            url: urlport + 'comment/work/list',
                            type: 'POST',
                            data: JSON.stringify({
                                "pageNum": 1,
                                "pageSize": 5,
                                "refId": id,
                                "userId": userid
                            }),
                            timeout: 5000, //超时时间
                            contentType: "application/json;charset=utf-8",
                            dataType: 'json', //返回的数据格式
                            success: function (datalist) {
                                console.log("晒作品：");
                                console.log(datalist);
                                $("#gio #menucount").text(datalist.data.count);
                                callback(datalist);
                            },
                            error: function (errorMsg) {
                                console.log('错误');
                                console.log(errorMsg);
                            }
                        });

                        function callback(datalist) {
                            if (datalist.status == 200) {
                                $this.datalist = datalist.data;
                                // console.log($this.datalist.workList);
                            }
                        }
                    });

                    /*问答模块*/
                    $(document).ready(function () {
                        $.ajax({
                            url: urlport + 'comment/answer/list',
                            type: 'POST',
                            data: JSON.stringify({
                                "pageNum": 1,
                                "pageSize": 40,
                                "refId": id,
                                "userId": userid
                            }),
                            timeout: 5000, //超时时间
                            contentType: "application/json;charset=utf-8",
                            dataType: 'json', //返回的数据格式
                            success: function (dataask) {
                                console.log("问大家：");
                                console.log(dataask);
                                $("#gio #askcount").text(dataask.data.count);
                                callback(dataask);
                            },
                            error: function (errorMsg) {
                                console.log('错误');
                                console.log(errorMsg);
                            }
                        });

                        function callback(dataask) {
                            if (dataask.status == 200) {
                                $this.dataask = dataask.data;
                                // console.log($this.dataask);
                            }
                        }
                    });

                    /*参加活动菜谱列表*/
                    $(document).ready(function () {
                        $.ajax({
                            url: urlport2 + 'special/menuDetail',
                            type: 'POST',
                            data: JSON.stringify({"id": 156}),
                            timeout: 5000, //超时时间
                            contentType: "application/json;charset=utf-8",
                            dataType: 'json', //返回的数据格式
                            success: function (data) {
                                callback(data);
                            },
                            error: function (errorMsg) {
                                console.log('错误');
                                console.log(errorMsg);
                            }
                        });

                        function callback(datamenu) {
                            if (datamenu.status == 200) {
                                $this.datamenu = datamenu.data;
                                console.log($this.datamenu);
                            }
                        }
                    });

                    /*GIO参数集合*/
                    //发布时间
                    var date = new Date(data.createat);
                    Y = date.getFullYear() + '-';
                    M = (date.getMonth() + 1 < 10 ? '0' + (date.getMonth() + 1) : date.getMonth() + 1) + '-';
                    D = date.getDate() + ' ';
                    h = date.getHours() + ':';
                    m = date.getMinutes() + ':';
                    s = date.getSeconds();
                    var creattime = Y + M + D + h + m + s;
                    console.log(creattime);

                    $.loadComment({
                        "pageNum": 1,
                        "pageSize": 10,
                        "type": 6,
                        "refId": parseInt(id),
                        "userId": parseInt(userid)
                    }, 1);

                    //custom page code begin here
                    gio("page.set", "activity", "活动");//页面类型
                    gio("page.set", "ID", data.id);//id
                    gio("page.set", "titleactivity", data.title);//标题
                    gio("page.set", "creattime", creattime);//发布时间
                    gio("page.set", "commentCount", data.commentCount);//类型
                    //custom page code end here
                    gio('send');

                    /*GIO参数集合发送完毕*/

                    /*分享链接专用*/
                    var sharetitle = data.title;
                    var sharedesc = data.desc;
                    var shareimg = data.picture.path;
                    var sharestr = data.url;
                    var sharelink = sharestr.replace(/api/, "h5");
                    var jsoninfo = {
                        id: data.id,
                        type: 6,
                        sharetitle: sharetitle,
                        sharedesc: sharedesc,
                        shareimg: shareimg,
                        sharelink: sharelink
                    };
                    window.setTimeout(function () {
                        console.info(jsoninfo);
                        /*APP分享专用*/
                        if (device == null || device == "null") {
                            console.log("不是APP打开");
                        } else {
                            ft.shareInfo(jsoninfo, function (result) {

                            });

                        }
                    }, 2000);
                    /*微信分享专用*/
                    $.ajax({
                        type: 'GET',
                        url: urlport + 'wx/wxConfig.json?url=' + encodeURIComponent(window.location.href.split('#')[0]),
                        success: function (data) {
                            console.info(data.appId);
                            wx.config({
                                debug: false, // 开启调试模式,调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印。
                                appId: data.appId, // 必填，公众号的唯一标识
                                timestamp: data.timestamp, // 必填，生成签名的时间戳
                                nonceStr: data.nonceStr, // 必填，生成签名的随机串
                                signature: data.signature,
                                jsApiList: [
                                    "onMenuShareTimeline",
                                    "onMenuShareAppMessage",
                                    "onMenuShareQQ",
                                    "onMenuShareWeibo",
                                    "onMenuShareQZone"
                                ]
                            });
                            wx.ready(function () {
                                //分享给朋友圈
                                wx.onMenuShareTimeline({
                                    title: sharetitle, // 分享标题
                                    link: sharelink, // 分享链接，该链接域名或路径必须与当前页面对应的公众号JS安全域名一致
                                    imgUrl: shareimg, // 分享图标
                                    success: function () {
                                        // 用户确认分享后执行的回调函数
                                    },
                                    cancel: function () {
                                        // 用户取消分享后执行的回调函数
                                    }
                                });
                                //分享给朋友
                                wx.onMenuShareAppMessage({
                                    title: sharetitle, // 分享标题
                                    desc: sharedesc, // 分享描述
                                    link: sharelink, // 分享链接，该链接域名或路径必须与当前页面对应的公众号JS安全域名一致
                                    imgUrl: shareimg, // 分享图标
                                    type: '', // 分享类型,music、video或link，不填默认为link
                                    dataUrl: '', // 如果type是music或video，则要提供数据链接，默认为空
                                    success: function () {
                                        // 用户确认分享后执行的回调函数
                                    },
                                    cancel: function () {
                                        // 用户取消分享后执行的回调函数
                                    }
                                });
                            });
                        },
                        error: function (xhr, type) {
                            //alert(111);
                        }
                    });


                }

            },
            methods: {
                openlist: function () {
                    $(".menulist").show();
                    $("html,body").css({"overflow": "hidden"}); //禁用滚动条
                },
                closelist: function () {
                    $(".menulist").hide();
                    $("html,body").css({"overflow": "auto"}); //启用滚动条
                },
                atten: function () {
                    if (this.isgray) return;
                    this.isgray = true;
                    console.info(11);
                },
                play: function (obj) {
                    var obj = document.getElementById("video");
                    obj.play();
                    document.getElementById("play").style.display = 'none';
                    obj.controls = true;
                    obj.addEventListener('ended', function () {
                        document.getElementById("play").style.display = 'block';
                        obj.controls = false;
                    });
                    obj.addEventListener('pause', function () {
                        document.getElementById("play").style.display = 'block';
                        obj.controls = false;
                    });
                    //console.info(55);
                },
                imgclick: function (obj) {
                    /*点击查看大图*/
                    // console.log(obj.currentTarget);
                    var imgdom = obj.currentTarget.innerHTML;
                    $("#imgSrc").empty().append(imgdom.toString());
                    var _this = $("#imgSrc .pageimg2");
                    // console.log(_this.attr("src"));
                    imgShow("#outerdiv", "#innerdiv", "#bigimg", _this);
                },
                deeplikopen: function (obj) {
                    function GetQueryString(name) {
                        var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
                        var r = window.location.search.substr(1).match(reg);
                        if (r != null) return unescape(r[2]);
                        return null;
                    }

                    var id = GetQueryString("id");

                    function GetPageName() {
                        var url = window.location.href;//获取完整URL
                        var tmp = location.pathname.replace(/(.+)[＼＼/]/, "");//获取带后缀的文件名称
                        name = tmp.replace(/.html/, "");//获取不带后缀的文件名称
                        return name;
                    }

                    // alert(GetPageName());
                    /*页面参数（页面类型+id）*/
                    var id = id;
                    var refid = id;
                    var action = GetPageName();
                    var weburl = window.location.protocol + "//" + window.location.host + window.location.pathname + "?id=" + id;
                    var imageURL = "";
                    var shareTitle = "";
                    var shareSubTitle = "";
                    var iostype = "";

                    console.log({
                        "id": id,
                        "action": action,
                        "weburl": weburl,
                        "refid": refid,
                        "imageURL": imageURL,
                        "shareTitle": shareTitle,
                        "shareSubTitle": shareSubTitle,
                        "iostype": iostype
                    });

                    var urlright = "?action=" + encodeURIComponent(action) +
                        "&id=" + encodeURIComponent(id) +
                        "&weburl=" + encodeURIComponent(weburl) +
                        "&refid=" + encodeURIComponent(refid) +
                        "&imageURL=" + encodeURIComponent(imageURL) +
                        "&shareTitle=" + encodeURIComponent(shareTitle) +
                        "&shareSubTitle=" + encodeURIComponent(shareSubTitle) +
                        "&iostype=" + encodeURIComponent(iostype);

                    /*判断是IOS还是Android机型*/
                    var u = navigator.userAgent;
                    var isAndroid = u.indexOf('Android') > -1 || u.indexOf('Adr') > -1; //android终端
                    var isiOS = !!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/); //ios终端
                    // console.log('是否是Android：' + isAndroid);
                    // console.log('是否是iOS：' + isiOS);

                    /*判断是否微信浏览器内打开*/
                    function isWeiXin() {
                        var ua = window.navigator.userAgent.toLowerCase();
                        // console.log(ua);//mozilla/5.0 (iphone; cpu iphone os 9_1 like mac os x) applewebkit/601.1.46 (khtml, like gecko)version/9.0 mobile/13b143 safari/601.1
                        if (ua.match(/MicroMessenger/i) == 'micromessenger') {
                            return true;
                        } else {
                            return false;
                        }
                    }

                    if (isWeiXin()) {
                        console.log(" 是来自微信内置浏览器");
                        /*弹出浏览器打开提示*/
                        var alertstr = "<div class='blackbg'><div class='reminder'>" +
                            "<img src='../img/arrowdashed.png' >" +
                            "<p class='title'>在微信中无法打开？</p>" +
                            "<p>请点击右上角，选择在浏览器或Safari中打开。</p>" +
                            "</div></div>";
                        $("body").prepend(alertstr);
                        $("html,body").css({"height": "100%", "position": "relative", "overflow": "hidden"}); //禁用滚动条

                        /*隐藏提示*/
                        $(".blackbg").unbind().click(function () {
                            $(".blackbg").remove();
                            $("html,body").css({"height": "auto", "position": "static", "overflow": "auto"}); //启用滚动条
                        });
                        $(".reminder").click(function (event) {
                            event.stopPropagation();//阻止冒泡
                        });

                    } else {
                        console.log("不是来自微信内置浏览器");
                        /*深链接打开*/
                        var deeplinkurl = "fotile://api.fotilestyle.com/" + urlright;
                        // alert(deeplinkurl);
                        window.location.href = deeplinkurl;
                        /***打开app的协议***/
                        window.setTimeout(function () {
                            if (isiOS == true) {/*ios手机*/
                                window.location.href = "https://gio.ren/re0Y923";
                            } else if (isAndroid == true) {/*Android手机*/
                                window.location.href = "https://gio.ren/rBZ2ApB";
                            }
                        }, 1000);

                    }
                },
                callKitchenware: function (obj) {
                    //app交互——唤起智能菜谱
                    // alert(obj.currentTarget.innerHTML);
                    var dom = obj.currentTarget.innerHTML;
                    $("#DeviceId").empty().append(dom.toString());
                    var dom2 = $("#DeviceId span").text();
                    // alert(dom2);
                    ft.callKitchenware({
                        pid: dom2.toString()
                    })
                },
                homeuser: function (userId) {
                    window.location.href = "home-user.html?id=" + userId;
                },
                star: function (obj) {
                    console.log(canClick);
                    if (!canClick) return;
                    canClick = false;

                    // app交互——获取登录状态
                    ft.isLogin(function (result) {
                        var errorcode = result.errorCode.toString();
                        if (errorcode == "1") {
                            //$api.toast('登陆成功', 2000);
                            userid = result.data.userId.toString();
                            if (userid !== "1" && userid !== 1) {
                                token = result.data.token.toString();
                            }
                            //alert(userid);
                            //收藏
                            var follow = $("#star").attr('class');
                            if (follow == "icon-msg") {
                                $.ajax({
                                    url: urlport + 'favorite/create',
                                    type: 'POST',
                                    data: JSON.stringify({
                                        "refId": id,
                                        "type": 1,
                                        "userId": userid
                                    }),
                                    timeout: 5000, //超时时间
                                    contentType: "application/json;charset=utf-8",
                                    dataType: 'json', //返回的数据格式
                                    success: function (data) {
                                        console.log(data);
                                        console.log("111");
                                        $("#star").addClass("icon-msg2");
                                        $("#star").removeClass("icon-msg");
                                        var oldnum = $("#star").next().text();
                                        $("#star").next().text(parseInt(oldnum) + 1);
                                        $api.toast('收藏成功！', 3000);
                                        /*友盟打点：菜谱收藏*/
                                        UMAnalyticsAgent.trackWithProperty("h5收藏菜谱", {
                                            "菜谱名称": data.data.name
                                        });
                                    },
                                    error: function (errorMsg) {
                                        console.log('错误');
                                        console.log(errorMsg);
                                    }
                                });
                            } else if (follow == "icon-msg2") {
                                $.ajax({
                                    url: urlport + 'favorite/cancel',
                                    type: 'POST',
                                    data: JSON.stringify({
                                        "refId": id,
                                        "type": 1,
                                        "userId": userid
                                    }),
                                    timeout: 5000, //超时时间
                                    contentType: "application/json;charset=utf-8",
                                    dataType: 'json', //返回的数据格式
                                    success: function (data) {
                                        console.log(data);
                                        console.log("222");
                                        $("#star").addClass("icon-msg");
                                        $("#star").removeClass("icon-msg2");
                                        var oldnum = $("#star").next().text();
                                        $("#star").next().text(parseInt(oldnum) - 1);
                                        $api.toast('取消收藏！', 3000);
                                    },
                                    error: function (errorMsg) {
                                        console.log('错误');
                                        console.log(errorMsg);
                                    }
                                });
                            }
                        } else if (errorCode == "0") {
                            $api.toast('登陆取消', 2000);
                        } else if (errorCode == "-1") {
                            $api.toast('登陆失败', 2000);
                        } else if (errorCode == "-2") {
                            $api.toast('登陆不支持', 2000);
                        }
                    });

                    setTimeout(function () {
                        canClick = true;
                    }, 3000);


                }

            }
        });

    }


</script>
</body>
</html>
