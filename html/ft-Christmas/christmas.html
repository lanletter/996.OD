<!DOCTYPE html>
<html>

<head>
    <title>圣诞活动页</title>
    <meta charset="utf-8">
    <meta name='viewport'
          content='width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no,minimum-scale=1.0'>
    <link rel="stylesheet" type="text/css" href="../../css/common.css">
    <link rel="stylesheet" type="text/css" href="../../css/swiper.min.css">
    <link rel="stylesheet" type="text/css" href="css/christmas.css">
    <style>
        body {
            background: #ffffff;
        }
    </style>
    <script type='text/javascript'>
        var _vds = _vds || [];
        window._vds = _vds;
        (function(){
            _vds.push(['setAccountId', '您的项目ID']);
            (function() {
                var vds = document.createElement('script');
                vds.type='text/javascript';
                vds.async = true;
                vds.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + 'dn-growing.qbox.me/vds.js';
                var s = document.getElementsByTagName('script')[0];
                s.parentNode.insertBefore(vds, s);
            })();
        })();
    </script>
</head>

<body>
<div id="christmas">
    <img class="jpegsize" src="img/welcome.jpeg"/>
    <img class="ornament1" src="img/1.png"/>
    <img class="ornament2" src="img/2.png"/>
    <p class="font15">
        2017-2018<br/>
        方太生活家一直与你相伴<br/>
        这段新旧交替的时光里<br/>
        我们精心为你准备了18件不重样新年礼<br/>
        你的礼盒有多大，你来决定！<br/>
    </p>
    <p class="font15">
        活动规则：每人每日仅可领取成功一次<br/>
        活动时间：2017年12月22日-2018年1月13日<br/>
        <span class="darkred">领取tips：以下特殊日期有特别定制礼物</span>
    </p>
    <div class="redborder">
        <ul>
            <li>12月25日&nbsp;&nbsp;圣诞节&nbsp;&nbsp;&nbsp;&nbsp;01月01日&nbsp;&nbsp;元旦</li>
            <li>01月09日&nbsp;&nbsp;方太生活家上海体验馆&nbsp;6周岁</li>
            <li>01月13日&nbsp;&nbsp;方太生活家北京体验馆&nbsp;2周岁</li>
        </ul>
    </div>
    <div class="calendarBox">
        <ul class="notice">
            <div class="swiper-container">
                <div class="swiper-wrapper">
                    <!--<div class="swiper-slide">-->
                    <!--<span class="phoneNum">183****6549</span>-->
                    <!--领取了一个-->
                    <!--<span class="fontbold">艺术帆布袋</span>-->
                    <!--</div>-->
                    <!--<div class="swiper-slide">-->
                    <!--<span class="phoneNum">183****6549</span>-->
                    <!--领取了一个-->
                    <!--<span class="fontbold">艺术帆布袋</span>-->
                    <!--</div>-->
                    <!--<div class="swiper-slide">-->
                    <!--<span class="phoneNum">183****6549</span>-->
                    <!--领取了一个-->
                    <!--<span class="fontbold">艺术帆布袋</span>-->
                    <!--</div>-->
                </div>
            </div>
        </ul>
        <div id="calendar">
            <!--<div class="cells gift1">12月22日</div>-->
            <!--<div class="cells gift1">12月22日</div>-->
            <!--<div class="cells gift1">12月22日</div>-->
            <!--<div class="cells gift1">12月22日</div>-->
            <!--<div class="cells gift1">12月22日</div>-->
            <!--<div class="cells gift1">12月22日</div>-->
            <!--<div class="cells gift1">12月22日</div>-->
            <!--<div class="cells gift1">12月22日</div>-->
            <!--<div class="cells gift2"></div>-->
            <!--<div class="cells gift1">12月22日</div>-->
            <!--<div class="cells gift1">12月22日</div>-->
            <!--<div name="today" class="cells gift4"></div>-->
            <!--<div class="cells gift3">12月22日</div>-->
            <!--<div class="cells gift3">12月22日</div>-->
            <!--<div class="cells gift3">12月22日</div>-->
            <!--<div class="cells gift3">12月22日</div>-->
            <!--<div class="cells gift3">12月22日</div>-->
            <!--<div class="cells gift3">12月22日</div>-->
            <!--<div class="cells gift3">12月22日</div>-->
            <!--<div class="cells gift3">12月22日</div>-->
            <!--<div class="cells gift3">12月22日</div>-->
            <!--<div class="cells gift3">12月22日</div>-->
            <!--<div class="cells gift3">12月22日</div>-->
            <!--<div class="cells gift3">12月22日</div>-->
        </div>
    </div>
    <a class="mygift"><img class="ornament3" src="img/3.png"></a>
    <p class="font10">（活动结束后，我们将统一寄出您的新年礼盒）</p>
    <img class="ornament4" src="img/4.png">
    <img class="ornament5" src="img/5.png">
    <img class="ornament6" src="img/6.png">
    <div id="swipers">
        <div class="swiper-container2">
            <div class="swiper-wrapper">

            </div>
        </div>
        <!-- Add Pagination -->
        <!--<div class="swiper-pagination"></div>-->
        <ul class="pagination"></ul>
    </div>
    <img class="ornament7" src="img/7.png">
    <img class="ornament8" src="img/8.png">
    <img class="ornament9" src="img/9.png">
    <img class="ornament10" src="img/10.png">
    <p class="redtitle">微博话题:</p>
    <p class="redtext">家的年年岁岁 01月07日-13日</p>
    <a class="a_btn grey_btn">点击参与</a>
    <img class="ornament11" src="img/11.png">
    <p class="redtitle">圣诞美食菜谱:</p>
    <p class="redtext">12月25日</p>
    <a href="https://h5.fotilestyle.com/html/lifearticle.html?id=813" class="a_btn red_btn">点击参与</a>
    <p class="redtitle">元旦美食菜谱:</p>
    <p class="redtext">01月01日</p>
    <a href="https://h5.fotilestyle.com/html/lifearticle.html?id=830" class="a_btn red_btn">点击参与</a>
    <p class="redtitle">app有奖话题:</p>
    <p class="redtext">
        南北大讨论-你的家乡元旦吃什么？<br/>
        12月30日-01月05日
    </p>
    <a class="a_btn grey_btn">点击参与</a>
    <img class="ornament12" src="img/12.png">
</div>
<script type="text/javascript" src='../../js/remjs.js'></script>
<script type="text/javascript" src='../../js/jquery.min.js'></script>
<script type="text/javascript" src='../../js/jquery.cookie.js'></script>
<script type="text/javascript" src='../../js/swiper.jquery.min.js'></script>
<script type="text/javascript" src='../../js/url.js'></script>
<script type="text/javascript" src='../../js/ft.js'></script>

<script type="text/javascript">
    function GetQueryString(name) {
        var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
        var r = window.location.search.substr(1).match(reg);
        if (r != null) return unescape(r[2]);
        return null;
    }

    var device = GetQueryString("device");
    var userid = GetQueryString("userid");
    // var userid = 123;
    $.cookie('userid', userid);

    var url = window.location.href;
    console.log(userid);
    console.log(url);

    if (device == "ios" || device == "android") {
        //app交互—获取userid
        window.onload = function () {
            ft.isLogin2(function (result) {
                var errorcode = result.errorCode.toString();
                //alert(errorcode);
                console.log(errorcode);
                if (errorcode == "1") {
                    userid = result.data.userId.toString();
                    $.cookie('userid', userid);

                    christmasActive(userid);

                } else if (errorCode == "0") {
                } else if (errorCode == "-1") {
                } else if (errorCode == "-2") {
                }
            });
        };
    } else {
        christmasActive(userid);
        $(".ornament12").on("click", function () {
            window.location.href = "https://t.growingio.com/app/at2/xRxa2xP5_o";
        })
    }

    function christmasActive(userid) {
        console.log({"userId": userid});
        /*日历显示抽奖状态*/
        $.ajax({
            url: urlport + 'activity/campaign/201712/calendar/list',
            type: 'POST',
            data: JSON.stringify({"userId": userid}),
            timeout: 5000, //超时时间
            contentType: "application/json;charset=utf-8",
            dataType: 'json', //返回的数据格式：json/xml/html/script/jsonp/text
            success: function (data) {
                console.log(data);
                var datelist = data.data;
                $.each(datelist, function (key, val) {
                    var overduekey = val.overdue;
                    var prizekey = val.prize;
                    if (overduekey == -1 && prizekey == null) {
                        val.giftclass = "gift1";
                    } else if (overduekey == -1 && prizekey == 0) {//过期没登录
                        val.giftclass = "gift1";
                    } else if (overduekey == -1 && prizekey == 1) {//过期已抽奖
                        val.giftclass = "gift2";
                        val.date = "";
                    } else if (overduekey == 0 && prizekey == 0) {//当前没抽奖
                        val.giftclass = "gift3";
                    } else if (overduekey == 0 && prizekey == 1) {//当前已抽奖
                        val.giftclass = "gift4";
                        val.date = "";
                    } else if (overduekey == 0 && prizekey == null) {//当前没登录
                        val.giftclass = "gift5";
                    } else if (overduekey == 1) {//以后
                        val.giftclass = "gift6";
                    }
                    if (overduekey == 0) {//今天
                        val.giftId = "today";
                    }
                });
                console.log(datelist);
                var datelistHtml = new Array();
                for(item=0;item<datelist.length;item++){
                    datelistHtml = $('<div id="' + datelist[item].giftId + '" class="cells ' + datelist[item].giftclass + '">' + datelist[item].date + '</div>');
                    $('#calendar').append(datelistHtml);
                }
                // datelist.forEach(function (item) {
                //     var datelist = $('<div id="' + item.giftId + '" class="cells ' + item.giftclass + '">' + item.date + '</div>');
                //     $('#calendar').append(datelist);
                // });

                /*未开始点击报错*/
                $(".gift6").on("click", function () {
                    alert("未到领取时间");
                });

                /*点击当天*/
                if (device == "ios" || device == "android") {
                    $("#today").on("click", function () {
                        ft.isLogin(function (result) {
                            var errorcode = result.errorCode.toString();
                            // alert("errorcode："+errorcode);
                            if (errorcode == "1") {
                                userid = result.data.userId.toString();
                                if (userid == null) {
                                    return;
                                }
                                ticketAjax(userid);
                            } else if (errorCode == "0") {
                                $api.toast('登陆取消', 2000);
                            } else if (errorCode == "-1") {
                                $api.toast('登陆失败', 2000);
                            } else if (errorCode == "-2") {
                                $api.toast('登陆不支持', 2000);
                            }
                        });
                    });
                } else {
                    $('#today').on('click', function () {
                        console.log(typeof(userid));
                        if (userid !== null || typeof(userid) !== "object") {
                            ticketAjax(userid);
                        } else {
                            var loginurl = "https://h5.fotilestyle.com/html/login/html/login.html";
                            window.location.href = loginurl;
                        }
                    });
                }
            },
            error: function (xhr) {
                console.log(xhr);
            }
        });

        /*点击抽奖*/
        function ticketAjax(userid) {
            $.ajax({
                url: urlport + 'activity/campaign/201712/lottery',
                type: 'POST',
                data: JSON.stringify({"userId": userid}),
                timeout: 5000, //超时时间
                contentType: "application/json;charset=utf-8",
                dataType: 'json', //返回的数据格式：json/xml/html/script/jsonp/text
                success: function (data) {
                    console.log(data);
                    if (data.status == 202) {
                        var giftObj = data.data;
                        var giftImg = giftObj.imgUrl;
                        var giftName = giftObj.prizename;
                        var congratulateurl = "congratulate.html?userid=" + userid + "&giftImg=" + giftImg + "&giftName=" + giftName + "&device=" + device;
                        console.log(congratulateurl);
                        window.location.href = congratulateurl;
                    } else {
                        var errorMessage = data.errorMessage;
                        alert(errorMessage);
                    }
                },
                error: function (xhr) {
                    console.log(xhr);
                    alert(xhr);
                }
            });
        }

        /*查看我的礼盒*/
        if (device == "ios" || device == "android") {
            $(".mygift").on("click", function () {
                ft.isLogin(function (result) {
                    var errorcode = result.errorCode.toString();
                    // alert("errorcode："+errorcode);
                    if (errorcode == "1") {
                        userid = result.data.userId.toString();
                        if (userid == null) {
                            return;
                        }
                        // alert("errorcode："+errorcode);
                        var mygifturl = "mygift.html?userid=" + userid + "&device=" + device;
                        console.log(mygifturl);
                        window.location.href = mygifturl;
                    } else if (errorCode == "0") {
                        $api.toast('登陆取消', 2000);
                    } else if (errorCode == "-1") {
                        $api.toast('登陆失败', 2000);
                    } else if (errorCode == "-2") {
                        $api.toast('登陆不支持', 2000);
                    }
                });
            });
        } else {
            $(".mygift").on("click", function () {
                if (userid == null || typeof(userid) == "undefined") {
                    var loginurl = "https://h5.fotilestyle.com/html/login/html/login.html?url=" + url;
                    console.log(loginurl);
                    window.location.href = loginurl;
                } else {
                    console.log(userid);
                    var mygifturl = "mygift.html?userid=" + userid + "&device=" + device;
                    console.log(mygifturl);
                    window.location.href = mygifturl;
                }
            });
            $(".ornament12").on("click", function () {
                window.location.href = "https://t.growingio.com/app/at2/xogaz2Rm_o";
            });

        }

        /*获奖人滚动播放*/
        $.ajax({
            url: urlport + 'activity/campaign/201712/log',
            type: 'POST',
            data: JSON.stringify({}),
            timeout: 5000, //超时时间
            contentType: "application/json;charset=utf-8",
            dataType: 'json', //返回的数据格式：json/xml/html/script/jsonp/text
            success: function (data) {
                console.log(data);
                var userlist = data.data;
                userlist.forEach(function (item) {
                    $.each(userlist, function (item, index) {
                        var userlist = "";
                        userlist += "" +
                            "<div class='swiper-slide'>" +
                            "<span class='phoneNum'>" + index.name + "</span>领取了一个" +
                            "<span class='fontbold'>" + index.prizename + "</span>" +
                            "</div>" +
                            "";
                        $(".notice .swiper-wrapper").append(userlist);
                    });
                });
            },
            error: function (xhr) {
                console.log(xhr);
            }
        });

        /*活动swiper*/
        $.ajax({
            url: urlport + 'activity/campaign/201712/url/list',
            type: 'POST',
            data: JSON.stringify({}),
            timeout: 5000, //超时时间
            contentType: "application/json;charset=utf-8",
            dataType: 'json', //返回的数据格式：json/xml/html/script/jsonp/text
            success: function (data) {
                console.log(data);
                var swiperlist = data.data;
                var swiperlistHtml = new Array();
                for(item=0;item<swiperlist.length;item++){
                    swiperlistHtml = "" +
                        "<div class='swiper-slide cards'>" +
                        "<img class='cityName' src=" + swiperlist[item].picture.path + ">" +
                        "<span class='bigtitle'>" + swiperlist[item].name + "</span>" +
                        "<div class='timetitle'>" + swiperlist[item].content + "</div>" +
                        "<a class='urltitle' href=" + swiperlist[item].url + ">点击查看活动详情</a>" +
                        "</div>" +
                        "";
                    $('#swipers .swiper-wrapper').append(swiperlistHtml);
                }

                // $.each(swiperlist, function (item, index) {
                //     var list = "";
                //     list += "" +
                //         "<div class='swiper-slide cards'>" +
                //         "<img class='cityName' src=" + index.picture.path + ">" +
                //         "<span class='bigtitle'>" + index.name + "</span>" +
                //         "<div class='timetitle'>" + index.content + "</div>" +
                //         "<a class='urltitle' href=" + index.url + ">点击查看活动详情</a>" +
                //         "</div>" +
                //         "";
                //     $("#swipers .swiper-wrapper").append(list);
                // });
                $.each($('.urltitle'),function(){
                    if($(this).attr('href')==''){
                        $(this).hide();
                    }
                })
            },
            error: function (xhr) {
                console.log(xhr);
            }
        });


        var swiper = new Swiper('.swiper-container', {
            direction: 'vertical',
            paginationClickable: true,
            centeredSlides: true,
            autoplay: 2500,
            autoplayDisableOnInteraction: false,
            observer: true,//修改swiper自己或子元素时，自动初始化swiper
            observeParents: false,//修改swiper的父元素时，自动初始化swiper
            onSlideChangeEnd: function (swiper) {
                swiper.update();
                swiper.startAutoplay();
                swiper.reLoop();
            },
        });
        var swiper2 = new Swiper('.swiper-container2', {
            slidesPerView: 'auto',
            centeredSlides: true,
            paginationClickable: true,
            spaceBetween: 20,
            observer: true,//修改swiper自己或子元素时，自动初始化swiper
            observeParents: false,//修改swiper的父元素时，自动初始化swiper
            onSlideChangeEnd: function (swiper) {
                swiper.update();
                swiper2.startAutoplay();
            },
            pagination: '.pagination',
            paginationType: 'custom',
            paginationCustomRender: function (swiper, current, total) {
                var _html = '';
                for (var i = 1; i <= total; i++) {
                    if (current == i) {
                        _html += '<li class="swiper-pagination-custom active"></li>';
                    } else {
                        _html += '<li class="swiper-pagination-custom"></li>';
                    }
                }
                return _html;//返回所有的页码html
            }
        });
    }


</script>

<script type="text/javascript" src='../../js/swiper.jquery.min.js'></script>
</body>
</html>
