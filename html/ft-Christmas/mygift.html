<!DOCTYPE html>
<html lang="en">
<head>
    <title>祝贺你！</title>
    <meta charset="utf-8">
    <meta name='viewport'
          content='width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no,minimum-scale=1.0'>
    <link rel="stylesheet" type="text/css" href="../../css/common.css">
    <link rel="stylesheet" type="text/css" href="css/christmas.css">
    <style>
        body {
            background: rgba(47, 47, 47, 0.35);
        }
    </style>
</head>
<body>
<div id="mygift">
    <a class="close"></a>
    <img class="title" src="img/3-1.png">
    <img class="light" src="img/light.png">
    <div class="giftbg">
        <ul>

        </ul>
    </div>
    <img class="myaddress" src="img/adresstitle.png">
    <ul class="userinfo">
        <li>
            <span class="key">收件人：</span>
            <input type="text" class="value name">
        </li>
        <li>
            <span class="key">电话号码：</span>
            <input type="text" id="phonenum" class="value tel" maxlength="11" onkeyup="this.value=this.value.replace(/\D/g,'')">
        </li>
        <li>
            <span class="key">收货地址：</span>
            <textarea class="value address"></textarea>
        </li>
    </ul>
    <img class="save" src="img/3-3.png">
</div>
<script type="text/javascript" src='../../js/remjs.js'></script>
<script type="text/javascript" src='../../js/jquery.min.js'></script>
<script type="text/javascript" src='../../js/jquery.cookie.js'></script>
<script type="text/javascript" src='../../js/swiper.jquery.min.js'></script>
<script type="text/javascript" src='../../js/url.js'></script>
<script>

    function GetQueryString(name) {
        var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
        var r = window.location.search.substr(1).match(reg);
        if (r != null) return unescape(r[2]);
        return null;
    }

    var userid = GetQueryString("userid");
    // var userid = $.cookie('userid');
    console.log(userid);
    // userid = 123;

    /*我的奖品*/
    $.ajax({
        url: urlport + 'activity/campaign/201712/list',
        type: 'POST',
        data: JSON.stringify({"userId": userid}),
        timeout: 5000, //超时时间
        contentType: "application/json;charset=utf-8",
        dataType: 'json', //返回的数据格式：json/xml/html/script/jsonp/text
        success: function (data) {
            console.log(data);
            var giftlist = data.data;
            if(giftlist.length==0 || typeof(giftlist)==null){
                $(".giftbg ul").append("<p style='text-align: center;'>您还没有抢到任何礼物！</p>");
            }else {
                $.each(giftlist, function (item, index) {
                    var lilist = "";
                    lilist += "<li>" +
                        "<img src=" + index.imgurl + ">" +
                        "<div>" +
                        "<span>" + index.prizename + "</span>" +
                        "<span>" + index.unit + "</span>" +
                        "</div>" +
                        "</li>";
                    $(".giftbg ul").append(lilist);
                });
            }
        },
        error: function (xhr) {
            console.log(xhr);
        }
    });

    /*地址获取*/
    $.ajax({
        url: urlport + 'activity/campaign/201712/adress/detail',
        type: 'POST',
        data: JSON.stringify({
            "userId": userid
        }),
        timeout: 5000, //超时时间
        contentType: "application/json;charset=utf-8",
        dataType: 'json', //返回的数据格式：json/xml/html/script/jsonp/text
        success: function (data) {
            console.log(data);
            var address=data.data;
            $(".userinfo .name").val(address.name);
            $(".userinfo .tel").val(address.phone);
            $(".userinfo .address").val(address.adress)
        },
        error: function (xhr) {
            console.log(xhr);
        }
    });
    /*地址保存*/
    $(".save").on("click", function () {
        var phone = document.getElementById('phonenum').value;
        if (!(/^1(3|4|5|7|8)\d{9}$/.test(phone))) {
            alert('手机号码输入有误，请重新输入');
            document.getElementById("phonenum").value = "";
            $("#delete1").css("display", "none");
            return false;
        }
        $.ajax({
            url: urlport + 'activity/campaign/201712/adress/save',
            type: 'POST',
            data: JSON.stringify({
                "userId": userid,
                "name": $(".userinfo .name").val(),
                "phone": $(".userinfo .tel").val(),
                "adress": $(".userinfo .address").val()
            }),
            timeout: 5000, //超时时间
            contentType: "application/json;charset=utf-8",
            dataType: 'json', //返回的数据格式：json/xml/html/script/jsonp/text
            success: function (data) {
                console.log(data);
                if(data.status==200){
                    alert("保存成功！");
                }
            },
            error: function (xhr) {
                console.log(xhr);
            }
        });
    });

    /*返回*/
    $(".close").on("click", function () {
        alert("back");
        var christmasurl = "christmas.html?userid="+userid;
        console.log(christmasurl);
        window.location.href = christmasurl;
    });
</script>
</body>
</html>