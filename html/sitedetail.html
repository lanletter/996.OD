<!DOCTYPE html>
<html>

<head>
  <title>场馆详情</title>
  <meta charset="utf-8">
  <meta
    content='width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no,minimum-scale=1.0,telephone=yes'
    name='viewport'>
  <!--<script src="../js/tingyun-rum.js"></script>-->
  <link href="../css/common.css?ver=420" rel="stylesheet" type="text/css">
  <link href="../css/swiper.min.css" rel="stylesheet" type="text/css">
  <link href="../css/sitedetail.css?ver=420" rel="stylesheet" type="text/css">
  <link href="../css/mobiscroll.core-2.6.2.css?ver=420" rel="stylesheet" type="text/css">
  <link href="../css/mobiscroll.animation-2.6.2.css?ver=420" rel="stylesheet" type="text/css">
  <script type='text/javascript'>
    !function (e, t, n, g, i) {
      e[i] = e[i] || function () {
        (e[i].q = e[i].q || []).push(arguments)
      }, n = t.createElement("script"), tag = t.getElementsByTagName("script")[0], n.async = 1, n.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + g, tag.parentNode.insertBefore(n, tag)
    }(window, document, "script", "assets.growingio.com/2.1/gio.js", "gio");
    gio('init', '80624a28abff7348', {});
  </script>
</head>

<body>
<div class="site">
  <header class="header pb216">
    <div class="header__main">
      <div class="site-img img"></div>
      <h3></h3>
    </div>
    <!--<div class="header__opt">-->
    <!--<span class="view-count"><i></i><strong></strong></span>-->
    <!--<span class="favorite-count" id="star"><strong>4321</strong></span>-->
    <!--</div>-->
    <div class="site-info info">
      <p class="des"></p>
      <ul class="ulinfo">
        <p class="title">场馆信息</p>
        <li class="address">
          <div>
            <p>
              <strong>场馆地址</strong>
              <span></span>
            </p>
            <a class="to-map" href="" id="foo"></a>
          </div>
        </li>
        <li class="service-time">
          <div>
            <p>
              <strong>服务时间</strong>
              <span>全年 <time></time></span>
            </p>
          </div>
        </li>
        <li class="tel">
          <div>
            <p>
              <strong>场馆电话</strong>
              <span></span>
              <em class="gold">电话备注信息</em>
            </p>
            <a class="to-call" href="#"><i></i></a>
          </div>
        </li>
        <li class="tel">
          <div>
            <p>
              <strong>邮件</strong>
              <span>fotile@qq.com</span>
              <em class="gold">电话备注信息</em>
            </p>
            <a class="copy" href="#">复制</a>
          </div>
        </li>
        <li class="tel">
          <div>
            <p>
              <strong>微信好友</strong>
              <span>微信号</span>
              <em class="gold">电话备注信息</em>
            </p>
            <a class="copy" href="#">复制</a>
          </div>
        </li>
      </ul>
    </div>
    
    
    <div class="site-detail clearfix">
      <h3 class="section-title">场地详情</h3>
      
      <div class="listbox">
        <div class="sitelist">
          <ul>
          
          </ul>
        </div>
      </div>
      <div class="sitelistdetail">
        <h4></h4>
        <p></p>
      </div>
      <div class="site-pic">
        <div id="swipers">
          <div class="swiper-container2">
            <div class="swiper-wrapper">
            
            </div>
          </div>
          <ul class="pagination"></ul>
        </div>
      </div>
    </div>
    
    
    <div class="site-service clearfix">
      <h3 class='section-title'>场馆服务</h3>
      <ul>
      </ul>
    </div>
  
  </header>
  
  <div class="order-byn mark ">
    <a class="click-yy red">预约体验</a>
    <a class="click-zl black">场地租赁</a>
  </div>
  <div class="order-pop pop-yy">
    <div class="pop">
      <div class="close" src="../img/closex.png"></div>
      <p class="title">预约体验</p>
      <ul>
        <li>
          <span class="key first">您的姓名</span>
          <input class="name" placeholder="姓名" readonlyunselectable="on" type="text">
        </li>
        <li>
          <span class="key">联系方式</span>
          <input class="tel" placeholder="手机号码" readonlyunselectable="on" type="tel">
        </li>
        <li>
          <span class="key">参观时间</span>
          <input class="order-time" placeholder="选择日期" readonlyunselectable="on" type="text">
        </li>
        <textarea class="remark" placeholder="备注（选填）"></textarea>
        <p class="tips">您可以在此预约场地参观、产品体验等 成功提交后，将有工作人员对您进行回访</p>
      </ul>
      <div class="btnbg">
        <a class="dark-btn commit-yy">提交</a>
      </div>
    </div>
  </div>
  <div class="order-pop pop-zl">
    <div class="pop">
      <div class="close" src="../img/closex.png"></div>
      <p class="title">租赁信息</p>
      <ul>
        <li>
          <span class="key first">您的姓名</span>
          <input class="name" placeholder="姓名" readonlyunselectable="on" type="text">
        </li>
        <li>
          <span class="key">联系方式</span>
          <input class="tel" placeholder="手机号码" readonlyunselectable="on" type="tel">
        </li>
        <li>
          <div class="order-type">
            <span class="key">租赁场地</span>
            <!--<div>-->
              <!--<button class="type-btn" value="1">场地参观<a style="display: none">1</a></button>-->
              <!--<button class="type-btn" value="2">场地租赁<a style="display: none">2</a></button>-->
              <!--<button class="type-btn" value="3">定制课程<a style="display: none">3</a></button>-->
            <!--</div>-->
            <div class="selects">
              <span class="placeholder">选择场地</span>
            </div>
            <dl class="selectBoxs" id=" " value="">
              <dd value=""><div class="status_circle status_circle_online"></div>待定</dd>
              <dd value=""><div class="status_circle "></div>烹饪教室</dd>
              <dd value=""><div class="status_circle "></div>会议室</dd>
              <dd value=""><div class="status_circle "></div>私厨会</dd>
              <dd value=""><div class="status_circle "></div>景厅</dd>
              <dd value=""><div class="status_circle "></div>咖啡吧</dd>
            </dl>
          </div>
        </li>
        <li>
          <span class="key">租赁时间</span>
          <input class="order-time" placeholder="选择日期" readonlyunselectable="on" type="text">
        </li>
        <textarea class="remark" placeholder="备注（选填）"></textarea>
        <p class="tips">您可以在此预约场地参观、产品体验等 成功提交后，将有工作人员对您进行回访</p>
      </ul>
      <div class="btnbg">
        <a class="dark-btn commit-zl">提交</a>
      </div>
    </div>
  </div>
</div>
<script type="text/javascript" src='../js/lib.js'></script>
<script type="text/javascript" src='../js/api.js'></script>
<script type="text/javascript" src='../js/jquery.cookie.js'></script>
<script type="text/javascript" src="../js/ajaxsetup.js"></script>
<script type="text/javascript" src='../js/loadcomment.js'></script>
<script type="text/javascript" src='../js/ft.js'></script>
<script type="text/javascript" src='../js/mobiscroll.core-2.6.2.js'></script>
<script type="text/javascript" src='../js/swiper.jquery.min.js'></script>
<script src="https://res.wx.qq.com/open/js/jweixin-1.2.0.js"></script>
<script src="../js/url.js"></script>
<script src="../js/UMAnalytics.js"></script>
<script type="text/javascript">
  //记录是否阻止滚动
  var disableScroll = false;
  //如果弹出对话框时，底层的视图就不让滚动了
  document.addEventListener('touchmove', function (e) {
    if (disableScroll) {
      e.preventDefault();
    }
  }, false);
  
  // function ChangeDiv(divId, divName, zDivCount) {
  //   console.log(parseInt(divId)+1);
  //   console.log(zDivCount);
  //   // for (i = 0; i <= zDivCount; i++) {
  //   //   document.getElementById(divName + i).style.display = "none";
  //   // }
  //   // document.getElementById(divName + divId).style.display = "block";
  // }
  
  $(function () {
    function GetQueryString(name) {
      var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
      var r = window.location.search.substr(1).match(reg);
      if (r != null) return unescape(r[2]);
      return null;
    }
    
    var id = GetQueryString("id");
    var device = GetQueryString("device");
    if (device == null || device == "null") {
      $(".footer").show();
    } else {
      $(".footer").hide();
    }
    
    $.ajax({
      url: urlport + 'store/detailSimple',
      type: 'POST',
      data: JSON.stringify({"id": id}),
      // timeout: 5000, //超时时间
      contentType: "application/json;charset=utf-8",
      dataType: 'json', //返回的数据格式
      success: function (res) {
        // console.log(res);
        callback(res);
      },
      error: function (errorMsg) {
        console.log('错误');
        console.log(errorMsg);
      }
    });
    
    function callback(res) {
      data = res.data;
      console.log(data);
      
      $("#foo").on("click", function () {
        var id = data.id;
        var lng = data.lng;
        var lat = data.lat;
        var sitename = data.storeName;
        var urlstr = "map.html?id=" + id + "&" + "lng=" + lng + "&" + "lat=" + lat + "&" + "sitename=" + sitename;
        //alert(urlstr);
        window.location.href = encodeURI(urlstr);
        //alert(encodeURI(urlstr));
        return false;
      });
      
      var $header = $('.header');
      $api.imgAdapt($header.find('.header__main .site-img'), data.titlePicture.path, 4 / 3);
      $header.find('h3').text(data.storeName);
      $header.find('.view-count').text(data.viewCount);
      $header.find('.favorite-count').text(data.likeCount);
      $header.find('.des').html(data.storeDesc);
      $header.find('.address span').text(data.detailAddress);
      $header.find('.tel span').text(data.tel);
      $header.find('.to-call').attr('href', 'tel:' + data.tel);
      $header.find('.service-time time').text(data.serviceTime);
      $('.site-service ul').html(data.remark);
      
      /* 判断是否能预约场馆 */
      if (data.type == 1) {
        $(".mark").show();
      } else {
        $(".mark").hide();
      }
      
      /*title取值*/
      var txt = data.title;
      if (txt == undefined) {
        $('head title').text("场馆详情");
      } else {
        $('head title').text(data.title);
      }
      
      /*友盟埋点-页面访问*/
      // var isuserid;//登录判断
      // if(userid !==1 && userid !=="1"){ isuserid = "是"; }else { isuserid = "否"; }
      // console.log(isuserid);
      // UMAnalyticsAgent.trackWithProperty("h5页面访问",{
      //     "页面类型":"场馆详情页",
      //     "页面名称": data.storeName,
      //     "是否登录":isuserid
      // });

//      data.storeServices.forEach(function(item, index) {
//        var item = $('<li>' + item.serviceName + '</li>');
//        $('.site-service ul').append(item);
//      });
      
      
      if (data.storeServices.length == 0) {
        $(".site-detail").css({display: "none"});
      } else {
        /*文字*/
        $(".sitelistdetail h4").text(data.storeServices[0].serviceTitle);
        $(".sitelistdetail p").text(data.storeServices[0].serviceDesc);
        /*图集*/
        var pictureList = data.storeServices[0].storeServicePictureList;
        console.log(pictureList.length);
        if(pictureList.length!==0){
          storePictures = pictureList;
          storePictures.forEach(function (item, index) {
            if (item.remark != null) {
              var img = $('<div class="swiper-slide">\
                    <figure>\
                <div class="imgbox" style="background-image:url(' + item.picture.path + ') "></div>\
                <figcaption>' + item.remark + '</figcaption>\
                </figure>\
                </div>');
            } else {
              var img = $('<div class="swiper-slide">\
                    <figure>\
              <img class="overlayimg" src="../img/Overlay Copy 2.png">\
              <img src="' + item.picture.path + '">\
              </figure>\
              </div>');
            }
            $('.swiper-wrapper').append(img);
          });
        }else {
          $('.site-pic').hide();
        }
        
      }
      /*tab标签*/
      if (data.storeServices.length >= 0) {
        data.storeServices.forEach(function (item, index) {
          // console.log(index);
          var JKDiv_ = "JKDiv_";
          if (index == 0) {
            var tabs = $('\
                <li class="cur">' + item.serviceName + '</li>\
                ');
          } else {
            var tabs = $('\
                <li>' + item.serviceName + '</li>\
                ');
          }
          $('.sitelist ul').append(tabs);
          // console.log(item);
          // item.pic=storePictures;
        });
      }
      console.log(data.storeServices);
      
      //切换轮播图
      $(".sitelist li").click(function (e) {
        console.log($(this).index());
        var index = $(this).index();
        //tab选项卡样式变更
        $(".sitelist li").removeClass("cur");
        $(this).addClass("cur");
        //文字内容变更
        $(".sitelistdetail h4").text(data.storeServices[index].serviceTitle);
        $(".sitelistdetail p").text(data.storeServices[index].serviceDesc);
        
        $('.swiper-wrapper .swiper-slide').remove();
        var pictureList=data.storeServices[index].storeServicePictureList;
        if(pictureList.length!==0){
          $('.site-pic').show();
          storePictures = pictureList;
          storePictures.forEach(function (item, index) {
            if (item.remark != null) {
              var img = $('<div class="swiper-slide">\
                    <figure>\
                <div class="imgbox" style="background-image:url(' + item.picture.path + ') "></div>\
                <figcaption>' + item.remark + '</figcaption>\
                </figure>\
                </div>');
            } else {
              var img = $('<div class="swiper-slide">\
                    <figure>\
              <img class="overlayimg" src="../img/Overlay Copy 2.png">\
              <img src="' + item.picture.path + '">\
              </figure>\
              </div>');
            }
            $('.swiper-wrapper').append(img);
          });
        }else {
          $('.swiper-wrapper .swiper-slide').remove();
        }
      });
      
      /*轮播图效果*/
      var swiper2 = new Swiper('.swiper-container2', {
        slidesPerView: 'auto',
        centeredSlides: true,
        paginationClickable: true,
        spaceBetween: 20,
        observer: true,//修改swiper自己或子元素时，自动初始化swiper
        observeParents: false,//修改swiper的父元素时，自动初始化swiper
        onSlideChangeEnd: function (swiper) {
          swiper.update();
          swiper2.startAutoplay();
        },
        pagination: '.pagination',
        paginationType: 'custom',
        paginationCustomRender: function (swiper, current, total) {
          var _html = '';
          for (var i = 1; i <= total; i++) {
            if (current == i) {
              _html += '<li class="swiper-pagination-custom active"></li>';
            } else {
              _html += '<li class="swiper-pagination-custom"></li>';
            }
          }
          return _html;//返回所有的页码html
        }
      });
      
      //预约选择
      var selectBox = $('.selectBoxs'); //下拉框
      var selectlist = $('.selectBoxs dd');
      var stuate = $('.selects span');  //点击状态
  
      stuate.click(function () {
        selectBox.show();
      });
  
      selectlist.click(function () {
        selectBox.hide();
        $(this).parent().find("div").removeClass("status_circle_online");
        $(this).find("div").addClass("status_circle_online");
        $(this).parent().prev().find("span").html($(this).text());
      });
      
      //预约
      $('.click-yy').on('click', function () {
        $('.pop-yy').show();
        $('.name').val("");
        $('.tel').val("");
        $('.order-type button').removeClass('check');
        $('.order-time').val("");
        $('.remark').val("");
        disableScroll = true;//禁止滚动
        $("html,body").css({overflow: "hidden"}); //禁用滚动条
        $(".mark").hide();
      });
      
      //租赁
      $('.click-zl').on('click', function () {
        $('.pop-zl').show();
        $('.name').val("");
        $('.tel').val("");
        $('.order-type button').removeClass('check');
        $('.order-time').val("");
        $('.remark').val("");
        disableScroll = true;//禁止滚动
        $("html,body").css({overflow: "hidden"}); //禁用滚动条
        $(".mark").hide();
      });
      
      
      +function () {
        var curr = new Date().getFullYear();
        var opt = {
          display: "bottom",
          lang: "zh",
          maxDate: new Date(2100, 3, 10, 9, 22),
          minDate: new Date(),
          mode: "scroller",
          preset: "datetime",
          stepMinute: 5,
          theme: "ios"
        };
        
        $('.order-time').val('').scroller('destroy').scroller(opt);
      }();
      
      +function () {
        $('.order-type').on('click', 'button', function (e) {
          $(e.target).toggleClass('check');
        })
      }();
      
      $('.commit-yy').on('click', function () {
        var orderInfo = $('.pop-yy'),
          name = orderInfo.find('.name').val().trim(),
          tel = orderInfo.find('.tel').val().trim(),
          type = orderInfo.find('.order-type .check').text(),
          time = orderInfo.find('.order-time').val().trim(),
          remark = orderInfo.find('.remark').val();
        
        /*时间戳转时间*/
        var str = time.toString();
        str = str.replace(/-/g, '/');
        var date = new Date(str);
        var time2 = date.getTime(str);
        
        if (!name) {
          alert('请输入姓名');
          return;
        }
        if (!tel || !/^\d{7,}$/.test(tel)) {
          alert('请正确输入联系方式');
          return;
        }
        var typestring = orderInfo.find('.order-type .check a').text();
        // if(typestring=="场地参观"){
        //     type=1;
        // }else if(typestring=="场地租赁"){
        //     type=2;
        // }else if(typestring=="定制课程"){
        //     type=3;
        // }
        if (!time) {
          alert('请选择预约时间');
          return;
        }
        
        console.log({
          name: name,
          tel: tel,
          serviceId: typestring,
          time: time2,
          remark: remark,
          storeId: data.id,
          userId:1,
          type:1
        });
        $api.post(urlport + 'user/appoint', {
          name: name,
          tel: tel,
          serviceId: typestring,
          time: time2,
          remark: remark,
          storeId: data.id,
          userId:1,
          type:1
        }, function (data) {
          console.log(data);
          $('.order-pop').hide();
          $('.order-byn').show();
          disableScroll = false;//允许滚动
          $("html,body").css({overflow: "auto"}); //启用滚动条
          $api.toast('提交成功！感谢您的预约，我们将在24小时内与您电话联系！谢谢！', 3000)
        })
      });
      $('.commit-zl').on('click', function () {
        var orderInfo = $('.pop-zl'),
          name = orderInfo.find('.name').val().trim(),
          tel = orderInfo.find('.tel').val().trim(),
          type = orderInfo.find('.order-type .placeholder').text(),
          time = orderInfo.find('.order-time').val().trim(),
          remark = orderInfo.find('.remark').val();
    
        /*时间戳转时间*/
        var str = time.toString();
        str = str.replace(/-/g, '/');
        var date = new Date(str);
        var time2 = date.getTime(str);
    
        if (!name) {
          alert('请输入姓名');
          return;
        }
        if (!tel || !/^\d{7,}$/.test(tel)) {
          alert('请正确输入联系方式');
          return;
        }
        if (type=="选择场地") {
          alert('请选择预约类型');
          return;
        }
        var typestring = orderInfo.find('.order-type .check a').text();
        // if(typestring=="场地参观"){
        //     type=1;
        // }else if(typestring=="场地租赁"){
        //     type=2;
        // }else if(typestring=="定制课程"){
        //     type=3;
        // }
        if (!time) {
          alert('请选择预约时间');
          return;
        }
    
        console.log({
          name: name,
          tel: tel,
          serviceId: typestring,
          time: time2,
          remark: remark,
          storeId: data.id,
          userId:1,
          type:2,
          rentType:$(".selects .placeholder").text()
        });
        $api.post(urlport + 'user/appoint', {
          name: name,
          tel: tel,
          serviceId: typestring,
          time: time2,
          remark: remark,
          storeId: data.id,
          userId:1,
          type:2,
          rentType:$(".selects .placeholder").text()
        }, function (data) {
          console.log(data);
          $('.order-pop').hide();
          $('.order-byn').show();
          disableScroll = false;//允许滚动
          $("html,body").css({overflow: "auto"}); //启用滚动条
          $api.toast('提交成功！感谢您的预约，我们将在24小时内与您电话联系！谢谢！', 3000)
        })
      });
      $('.close').on('click', function () {
        $('.order-pop').hide();
        $(".mark").show();
        disableScroll = false;//允许滚动
        $("html,body").css({overflow: "auto"}); //启用滚动条
      });
      
      /*分享链接专用*/
      var sharetitle = data.storeName;
      var sharedesc;
      var contents = $(".site-info .des").text().replace(/[\r\n]/g, "").replace(/(^\s+)|(\s+$)/g, "").replace(/\s/g, "");
      var count = contents.length;
      if (count > 40) {
        var nr = contents.substring(0, 40) + "...";
        sharedesc = nr;
      } else {
        sharedesc = contents;
      }
      var shareimg = data.titlePicture.path;
      var sharestr = data.url;
      var sharelink = sharestr.replace(/api/, "h5");
      var jsoninfo = {
        id: data.id,
        type: 8,
        sharetitle: sharetitle,
        sharedesc: sharedesc,
        shareimg: shareimg,
        sharelink: sharelink
      };
      window.setTimeout(function () {
        if (device == null || device == "null") {
          console.log("不是APP打开");
        } else {
          ft.shareInfo(jsoninfo, function (result) {
          
          });
          
        }
      }, 2000);
      /*微信分享专用*/
      $.ajax({
        type: 'GET',
        url: urlport + 'wx/wxConfig.json?url=' + encodeURIComponent(window.location.href.split('#')[0]),
        success: function (data) {
          // console.info(data.appId);
          wx.config({
            debug: false, // 开启调试模式,调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印。
            appId: data.appId, // 必填，公众号的唯一标识
            timestamp: data.timestamp, // 必填，生成签名的时间戳
            nonceStr: data.nonceStr, // 必填，生成签名的随机串
            signature: data.signature,
            jsApiList: [
              "onMenuShareTimeline",
              "onMenuShareAppMessage",
              "onMenuShareQQ",
              "onMenuShareWeibo",
              "onMenuShareQZone"
            ]
          });
          wx.ready(function () {
            //分享给朋友圈
            wx.onMenuShareTimeline({
              title: sharetitle, // 分享标题
              link: sharelink, // 分享链接，该链接域名或路径必须与当前页面对应的公众号JS安全域名一致
              imgUrl: shareimg, // 分享图标
              success: function () {
                // 用户确认分享后执行的回调函数
              },
              cancel: function () {
                // 用户取消分享后执行的回调函数
              }
            });
            //分享给朋友
            wx.onMenuShareAppMessage({
              title: sharetitle, // 分享标题
              desc: contents, // 分享描述
              link: sharelink, // 分享链接，该链接域名或路径必须与当前页面对应的公众号JS安全域名一致
              imgUrl: shareimg, // 分享图标
              type: '', // 分享类型,music、video或link，不填默认为link
              dataUrl: '', // 如果type是music或video，则要提供数据链接，默认为空
              success: function () {
                // 用户确认分享后执行的回调函数
              },
              cancel: function () {
                // 用户取消分享后执行的回调函数
              }
            });
          });
        },
        error: function (xhr, type) {
          //alert(111);
        }
      })
    }
    
  });
</script>
</body>

</html>
