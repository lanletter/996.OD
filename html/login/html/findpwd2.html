<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>密码找回</title>
    <meta charset="utf-8">
    <!-- 这是个iphone设备中的safari私有meta标签，它表示：允许全屏模式浏览；-->
    <meta content="yes" name="apple-mobile-web-app-capable">
    <!-- 全屏显示-->
    <meta name="apple-touch-fullscreen" content="yes">
    <meta name='viewport'
          content='width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no,minimum-scale=1.0'>
    <!-- DNS预解析-->
    <meta http-equiv="x-dns-prefetch-control" content="on">
    <link rel="stylesheet" type="text/css" href="../css/common.css?ver=403">
    <link rel="stylesheet" type="text/css" href="../css/findpwd.css?ver=403">
</head>
<body>
    <div class="divbreak"></div>
    <ul class="ulstyle">
        <li class="txtbig">请输入短信验证码</li>
        <li class="editshort">
            <input placeholder="验证码" id="codenum" maxlength="6"/>
            <img src="../img/findx.png" id="delete1">
            <p class="warn2" style="display: none;">验证码不正确，请重新输入</p>
        </li>
        <li class="codebtn">
            <button class="yellowbg" id="verifycode">获取验证码</button>
            <!--<button class="greybg">重新发送(60s)</button>-->
        </li>
        <li>
            <span class="nextbtn">下一步</span>
        </li>
    </ul>
</body>
<script type="text/javascript" src='../js/lib.js'></script>
<script type="text/javascript" src='../js/alertdiy.js'></script>
<script type="text/javascript" src='../js/jquery.cookie.js'></script>
<script>
    /*获取url*/
    function GetQueryString(name) {
        var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
        var r = window.location.search.substr(1).match(reg);
        if (r != null)return unescape(r[2]);
        return null;
    }
    var id = GetQueryString("id");
    var phonenum = $.cookie('phonenum');
    console.log(phonenum);
    /*输入框选中效果*/
    $(document).ready(function () {
        $("#codenum").focus(function () {
            $("#delete1").css("display", "block");
            $(".warn2").css("display", "none");
            $(".editshort").removeClass("bdred");
            $("#delete1").click(function () {
                $("#codenum").val("");
                $("#delete1").css("display", "none");
            });
            $("#codenum").keyup(function () {
                var tmptxt = $(this).val();
                $(this).val(tmptxt.replace(/\D|^0/g, ''));
            }).bind("paste", function () {
                var tmptxt = $(this).val();
                $(this).val(tmptxt.replace(/\D|^0/g, ''));
            }).css("ime-mode", "disabled");
        });
        $("#codenum").blur(function () {
            if ($("#codenum").val() == "") {
                $("#delete1").css("display", "none");
            }
        });
    });

    $("#verifycode").click(function () {
        /*倒计时60s*/
        function invokeSettime(obj) {
            var countdown = 60;
            settime(obj);
            function settime(obj) {
                if (countdown == 0) {
                    $(obj).attr("disabled", false);
                    $(obj).text("获取验证码");
                    $(obj).addClass("yellowbg");
                    $(obj).removeClass("greybg");
                    countdown = 60;
                    return;
                } else {
                    $(obj).attr("disabled", true);
                    $(obj).text("(" + countdown + ") s 重新发送");
                    $(obj).addClass("greybg");
                    $(obj).removeClass("yellowbg");
                    countdown--;
                }
                setTimeout(function () {
                    settime(obj)
                }, 1000)
            }
        }
        new invokeSettime("#verifycode");

        $.ajax({
            type: 'POST',
            url: 'https://h5.fotilestyle.com/AccountProxy/v2/getpin',
            datatype:"json",
            data:JSON.stringify({
                phone: phonenum,
                corp_id: "1007d4b036464a00"
            }),
            contentType:'application/json;charset=UTF-8',
            success: function (ret) {
//              alert(JSON.stringify(ret));
                var obj = eval('(' + ret + ')');
//                if(obj.resultCode=="2004"){
//                    alert("请求次数太多");
//                }

            }
        });
    });

    $(".nextbtn").click(function () {
        if (!loginInputValid()) return;
        $.cookie('phonenum', $("#phonenum").val());
        $.cookie('codenum', $("#codenum").val());
        var buyurl = "findpwd3.html?id=" + id;
        console.log(buyurl);
        window.location.href = buyurl;
    });
    function loginInputValid() {
        var codenum = document.getElementById('codenum').value;
        if (!(/^\d{6}$/.test(codenum))) {
            document.getElementById("codenum").value = "";
            $("#delete1").css("display", "none");
            $(".warn2").css("display", "block");
            $(".editshort").addClass("bdred");
            return false;
        }
        return true;
    }
</script>
</html>